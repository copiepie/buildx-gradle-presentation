<html>
  <head>
    <title>Buildx & Gradle</title>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section
          data-background-image="port-container.gif"
          data-background-opacity="0.6"
        >
          <h1
            class="r-fit-text"
            style="text-align: left; color: navy; text-shadow: black"
          >
            Multiplatform Docker Images with Gradle
          </h1>
          <hr color="navy" />
        </section>
        <section
          data-background-video="content.mp4"
          data-background-opacity="0.6"
          data-background-video-loop="true"
        >
          <h2 style="color: navy; text-align: left">Contents</h2>

          <p class="fragment" style="color: navy; text-align: left">
            Motivation
          </p>
          <p class="fragment" style="color: navy; text-align: left">
            Manifests
          </p>
          <p class="fragment" style="color: navy; text-align: left">
            Tools (Buildkit, Buildx)
          </p>
          <p class="fragment" style="color: navy; text-align: left">
            Demo Demo Demo!!!
          </p>
          <p class="fragment" style="color: navy; text-align: left">
            Limitations
          </p>
        </section>
        <section
          data-background-video="motivation.mp4"
          data-background-opacity="0.6"
          data-background-video-loop="true"
        >
          <h2 style="color: navy; text-align: left">Motivation</h2>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            There's more than x86_64
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            <a href="https://g.co/kgs/FLQLTm">apple's new M1 CPU</a> is arm64
            based
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            <a
              href="https://aws.amazon.com/pm/ec2-graviton/?trk=40424652-394c-43fa-bfea-8301a1898829&sc_channel=ps&sc_campaign=acquisition&sc_medium=ACQ-P|PS-GO|Brand|Desktop|SU|Compute|EC2%20Graviton|EEM|EN|Text|EU&s_kwcid=AL!4422!3!525634705654!p!!g!!amazon%20web%20servers&ef_id=CjwKCAjwloCSBhAeEiwA3hVo_TIDmfVLYbEMO-JEDXPQYN5q0I0LSMWV_M3SYCL1Dm9jwFtNgpaZbBoCWMUQAvD_BwE:G:s&s_kwcid=AL!4422!3!525634705654!p!!g!!amazon%20web%20servers"
              >AWS Gravitron2</a
            >
            Instances are arm64 based
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            a container built for x86_64 (amd64) won't work on arm64 (at least
            not properly)
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            Target group: Development teams using different workstations
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            we need a way to build the right image for the right platform
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            we need this to be built on a Dev's workstation and on our CI
          </p>
        </section>
        <section
          data-background-video="manifest.mp4"
          data-background-opacity="0.6"
          data-background-video-loop="true"
        >
          <h2 style="color: navy; text-align: left">
            Multiple images with the same tag
          </h2>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            Made possible via manifests
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            Manifests contain meta-information about an image...
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            ...which also includes the platform an image is built for
          </p>
          <p
            class="fragment"
            style="font-size: smaller; color: navy; text-align: left"
          >
            Otherwise we would need to build completely separate images per
            platform<br />
            <span style="font-style: italic"
              >(which also means our build process would be complex and thus
              hard to maintain)</span
            >
          </p>
        </section>
        <section data-background-image="demo.gif" data-background-opacity="0.6">
          <h2 style="color: navy; text-align: left">Demo for manifestts</h2>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-family: 'Courier New', Courier, monospace;
            "
          >
            docker manifest inspect
            ghcr.io/copiepie/simply-spring-rest-docker-test:1
          </p>
        </section>
        <section
          data-background-video="tools.mp4"
          data-background-opacity="0.6"
          data-background-video-loop="true"
        >
          <h2 style="color: navy; text-align: left">Tools</h2>
          <p class="fragment" style="color: navy; text-align: left">BuildKit</p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - A project to separate the build logic
          </p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Builder-backend for building Docker images, can be activated via
            DOCKER_BUILDKIT=1
          </p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Provides optimizations for multistage builds
          </p>
          <p class="fragment" style="color: navy; text-align: left">buildx</p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - CLI Plugin to extend docker with full support of buildkit
          </p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Needs to be installed/activated (docker buildx install)
          </p>
        </section>
        <section
          data-background-image="multiplatform.gif"
          data-background-opacity="0.6"
        >
          <h2 style="color: navy; text-align: left">Multiplatform builds</h2>
          <p
            class="fragment"
            style="
              font-size: smaller;
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Default is to build an image for the architecture where buildx is
            executed upon
          </p>
          <p
            class="fragment"
            style="
              font-size: smaller;
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Build for a particular platform via --platform flag, perhaps
            --platform=linux/arm64
          </p>
          <p
            class="fragment"
            style="
              font-size: smaller;
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - A separate builder instance is needed, since multi-platform images
            is only supported via BuildKit with docker-container driver <br />
            <span style="font-style: italic">(Or via k8s drivers) </span>
          </p>
          <p
            class="fragment"
            style="
              font-size: smaller;
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Builder might emulate desired target architecture; or it might
            not... <br />
            In case it doesn't, additional emulation capabilities are needed via
            <a href="https://www.qemu.org/">QEMU</a>
          </p>
        </section>

        <section data-background-image="demo.gif" data-background-opacity="0.6">
          <h2 style="color: navy; text-align: left">Buildx Demo</h2>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Setup buildx <br />
            <span
              style="
                font-family: 'Courier New', Courier, monospace;
                font-style: normal;
              "
            >
              docker buildx install
            </span>
            <br />
            <span
              style="
                font-family: 'Courier New', Courier, monospace;
                font-style: normal;
              "
            >
              docker buildx create
            </span>
            <br />
            <span
              style="
                font-family: 'Courier New', Courier, monospace;
                font-style: normal;
              "
            >
              docker buildx ls
            </span>
            <br />
            <span
              style="
                font-family: 'Courier New', Courier, monospace;
                font-style: normal;
              "
            >
              docker buildx use
            </span>
          </p>
        </section>
        <section
          data-background-image="gradle.gif"
          data-background-opacity="0.6"
        >
          <h2 style="color: navy; text-align: left">Gradle</h2>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Build tool with dependency management support
          </p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Rich API facilitates even tricky automation concerns
          </p>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - Plugin ecosystem enables extensibility
          </p>
        </section>
        <section
          data-background-image="walkthrough.gif"
          data-background-opacity="0.6"
        >
          <h2 style="color: navy; text-align: left">Plugin walkthrough</h2>
          <p
            class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;
            "
          >
            - A Gradle plugin consists out of 
            <ol class="fragment"
            style="
              color: navy;
              text-align: left;
              font-size: smaller;
              font-style: italic;">
              <li>The extension, which defines the configuration for the plugin</li>
              <li>The plugin code itself, which might register tasks for the plugin and uses the extension </li>
              <li>Tasks, which may be invoked in the script where the plugin is integrated</li>
            </ol>
          </p>
        </section>
        <section data-background-image="publish.gif" data-background-opacity="0.6">
          <h2 style="color: navy; text-align: left">
            Publishing and the GitHub workflow
          </h2>
        </section>
      </div>
    </div>
  </body>
</html>
